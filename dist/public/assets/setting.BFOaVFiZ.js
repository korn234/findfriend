import{r as l,u as B,c as q,b as k,j as e,a6 as D,d as K,e as _,S as $}from"./react-vendor.BNJGvZZE.js";import{t as G}from"./form-vendor.UGN1QS47.js";import{B as S,L as a,I as i,S as y,b as P,c as V,d as I,e as n,T as H}from"./ui.Ct99_20N.js";import{u as J,b as F,i as W,g as X,s as Y}from"./features.CjRTY6ot.js";import{u as Z}from"./vendor.BGj4DGRB.js";import"./ui-vendor.BQCqNqg0.js";const ee=["ชานมไข่มุก","กาแฟ","ดนตรี","ภาพยนตร์","อาหาร","ท่องเที่ยว","ออกกำลังกาย","อ่านหนังสือ","เกม","ถ่ายรูป","ช้อปปิ้ง","ทำอาหาร","ศิลปะ","กีฬา","แฟชั่น","เทคโนโลยี"],se=["กรุงเทพมหานคร","กระบี่","กาญจนบุรี","กาฬสินธุ์","กำแพงเพชร","ขอนแก่น","จันทบุรี","ฉะเชิงเทรา","ชลบุรี","ชัยนาท","ชัยภูมิ","ชุมพร","เชียงราย","เชียงใหม่","ตรัง","ตราด","ตาก","นครนายก","นครปฐม","นครพนม","นครราชสีมา","นครศรีธรรมราช","นครสวรรค์","นนทบุรี","นราธิวาส","น่าน","บึงกาฬ","บุรีรัมย์","ปทุมธานี","ประจวบคีรีขันธ์","ปราจีนบุรี","ปัตตานี","พระนครศรีอยุธยา","พังงา","พัทลุง","พิจิตร","พิษณุโลก","เพชรบุรี","เพชรบูรณ์","แพร่","ภูเก็ต","มหาสารคาม","มุกดาหาร","แม่ฮ่องสอน","ยโสธร","ยะลา","ร้อยเอ็ด","ระนอง","ระยอง","ราชบุรี","ลพบุรี","ลำปาง","ลำพูน","เลย","ศรีสะเกษ","สกลนคร","สงขลา","สตูล","สมุทรปราการ","สมุทรสาคร","สมุทรสงคราม","สระแก้ว","สระบุรี","สิงห์บุรี","สุโขทัย","สุพรรณบุรี","สุราษฎร์ธานี","สุรินทร์","หนองคาย","หนองบัวลำภู","อ่างทอง","อำนาจเจริญ","อุดรธานี","อุตรดิตถ์","อุทัยธานี","อุบลราชธานี"];function ce(){const{toast:f}=J(),[g,p]=l.useState(""),[,C]=Z(),[m,j]=l.useState([]),[T,d]=l.useState(""),[w,x]=l.useState([]),[te,u]=l.useState(""),[c,N]=l.useState(""),{data:r,isLoading:R}=B({queryKey:["/api/me"],queryFn:X({on401:"throw"})}),t=q({resolver:G(Y),defaultValues:{nickname:"",age:"",instagram:"",bio:"",interests:[],hobbies:"",province:"",school:"",currentPassword:"",newPassword:"",confirmNewPassword:""}});l.useEffect(()=>{r&&(t.setValue("nickname",r.nickname||""),t.setValue("age",r.age||""),t.setValue("instagram",r.instagram?.replace("@","")||""),t.setValue("bio",r.bio||""),t.setValue("hobbies",r.hobbies||""),t.setValue("province",r.province||""),t.setValue("school",r.school||""),r.interests&&(j(r.interests),t.setValue("interests",r.interests)),r.province&&N(r.province),r.school&&(u(r.school),d(r.school)),r.profileImage&&(p(r.profileImage),t.setValue("profileImage",r.profileImage)))},[r,t]);const E=s=>{const o=s.target.files?.[0];if(o){const h=new FileReader;h.onload=A=>{const v=A.target?.result;p(v),t.setValue("profileImage",v)},h.readAsDataURL(o)}},L=s=>{const o=m.includes(s)?m.filter(h=>h!==s):[...m,s];j(o),t.setValue("interests",o)},M=k({mutationFn:async s=>(await F("POST","/api/schools/search",s)).json(),onSuccess:s=>{x(s)}}),O=s=>{d(s),s.length>=2?M.mutate({query:s,province:c}):x([])},U=s=>{u(s.name),d(s.name),t.setValue("school",s.name),x([])},z=s=>{N(s),t.setValue("province",s),s!==c&&(u(""),d(""),t.setValue("school",""),x([]))},b=k({mutationFn:async s=>(await F("PUT","/api/me",s)).json(),onSuccess:()=>{W.user(),f({title:"อัพเดทโปรไฟล์สำเร็จ",description:"ข้อมูลของคุณถูกบันทึกแล้ว"})},onError:s=>{f({title:"อัพเดทโปรไฟล์ไม่สำเร็จ",description:s.message||"เกิดข้อผิดพลาด",variant:"destructive"})}}),Q=s=>{s.newPassword||(s.newPassword="",s.confirmNewPassword=""),b.mutate(s)};return R?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-tea-milk-light to-tea-milk-cream flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-accent-brown mx-auto mb-4"}),e.jsx("p",{className:"text-tea-milk-dark",children:"กำลังโหลดข้อมูล..."})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-tea-milk-light to-tea-milk-cream",children:e.jsxs("div",{className:"px-6 py-8",children:[e.jsxs("div",{className:"flex items-center mb-8",children:[e.jsx(S,{variant:"ghost",size:"sm",onClick:()=>C("/?tab=profile"),className:"mr-4 p-2 hover:bg-white/50 rounded-full",children:e.jsx(D,{className:"w-5 h-5 text-accent-brown"})}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-accent-brown mb-2",children:"⚙️ ตั้งค่า"}),e.jsx("p",{className:"text-tea-milk-dark",children:"แก้ไขข้อมูลส่วนตัว"})]})]}),e.jsxs("form",{onSubmit:t.handleSubmit(Q),className:"space-y-6 max-w-md mx-auto",children:[e.jsxs("div",{children:[e.jsx(a,{className:"block text-sm font-medium text-accent-brown mb-3",children:"รูปโปรไฟล์"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:E,className:"hidden",id:"photo-upload"}),e.jsx("label",{htmlFor:"photo-upload",className:"group block w-full aspect-[3/4] bg-white rounded-2xl border-2 border-dashed border-tea-milk-base hover:border-tea-milk-medium transition-all duration-300 cursor-pointer overflow-hidden card-hover",children:g?e.jsx("img",{src:g,alt:"Preview",className:"w-full h-full object-cover"}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-tea-milk-dark group-hover:text-accent-brown transition-colors duration-300",children:[e.jsx(K,{className:"w-12 h-12 mb-3 animate-bounce"}),e.jsx("p",{className:"text-sm font-medium",children:"เปลี่ยนรูปโปรไฟล์"}),e.jsx("p",{className:"text-xs mt-1",children:"แนวตั้ง สวยๆ"})]})})]})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"nickname",className:"block text-sm font-medium text-accent-brown mb-3",children:"ชื่อเล่น"}),e.jsx(i,{id:"nickname",type:"text",placeholder:"ชื่อเล่นที่ใช้ในแอป",className:"form-input rounded-xl border-0 bg-white ring-1 ring-tea-milk-base focus:ring-2 focus:ring-tea-milk-dark",...t.register("nickname")}),t.formState.errors.nickname&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:t.formState.errors.nickname.message})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"age",className:"block text-sm font-medium text-accent-brown mb-3",children:"อายุ"}),e.jsxs(y,{value:t.watch("age"),onValueChange:s=>t.setValue("age",s),children:[e.jsx(P,{className:"form-input w-full rounded-xl border-0 bg-white ring-1 ring-tea-milk-base focus:ring-2 focus:ring-tea-milk-dark",children:e.jsx(V,{placeholder:"-- เลือกช่วงอายุ --"})}),e.jsxs(I,{children:[e.jsx(n,{value:"12-15",children:"12-15 ปี"}),e.jsx(n,{value:"16-18",children:"16-18 ปี"}),e.jsx(n,{value:"19-22",children:"19-22 ปี"}),e.jsx(n,{value:"23-26",children:"23-26 ปี"}),e.jsx(n,{value:"27-30",children:"27-30 ปี"}),e.jsx(n,{value:"30+",children:"30+ ปี"})]})]}),t.formState.errors.age&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:t.formState.errors.age.message})]}),e.jsxs("div",{children:[e.jsxs(a,{htmlFor:"instagram",className:"block text-sm font-medium text-accent-brown mb-3",children:["Instagram ",e.jsx("span",{className:"text-sm text-gray-500",children:"(ไม่บังคับ)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"@"})}),e.jsx(i,{id:"instagram",type:"text",placeholder:"username",className:"form-input block w-full rounded-xl border-0 py-3 pl-8 pr-4 bg-white ring-1 ring-tea-milk-base focus:ring-2 focus:ring-tea-milk-dark",...t.register("instagram")})]})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"bio",className:"block text-sm font-medium text-accent-brown mb-3",children:"แนะนำตัวเอง"}),e.jsx(H,{id:"bio",placeholder:"เล่าให้ฟังหน่อยว่าคุณเป็นคนยังไง...",className:"form-input min-h-[120px] resize-none rounded-xl border-0 bg-white ring-1 ring-tea-milk-base focus:ring-2 focus:ring-tea-milk-dark",...t.register("bio")}),e.jsxs("div",{className:"flex justify-between mt-1",children:[t.formState.errors.bio&&e.jsx("p",{className:"text-sm text-red-600",children:t.formState.errors.bio.message}),e.jsxs("p",{className:"text-xs text-tea-milk-dark ml-auto",children:[t.watch("bio")?.length||0,"/200"]})]})]}),e.jsxs("div",{children:[e.jsx(a,{className:"block text-sm font-medium text-accent-brown mb-3",children:"ความชอบ"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ee.map((s,o)=>e.jsx("button",{type:"button",onClick:()=>L(s),className:"px-3 py-2 rounded-full text-sm font-medium transition-all duration-300 transform hover:scale-105",children:e.jsx("span",{className:`${m.includes(s)?"bg-gradient-to-r from-tea-milk-medium to-tea-milk-dark text-white shadow-tea":"bg-white text-tea-milk-dark border border-tea-milk-base hover:border-tea-milk-medium"} px-3 py-2 rounded-full transition-all duration-300`,children:s})},s))}),t.formState.errors.interests&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:t.formState.errors.interests.message})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"hobbies",className:"block text-sm font-medium text-accent-brown mb-3",children:"งานอดิเรก"}),e.jsx(i,{id:"hobbies",placeholder:"เช่น เล่นกีต้าร์, วาดรูป, ทำขนม...",className:"form-input rounded-xl border-0 bg-white ring-1 ring-tea-milk-base focus:ring-2 focus:ring-tea-milk-dark",...t.register("hobbies")}),t.formState.errors.hobbies&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:t.formState.errors.hobbies.message})]}),e.jsxs("div",{children:[e.jsxs(a,{className:"text-base font-medium text-gray-700 mb-3 block flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4"}),"จังหวัด"]}),e.jsxs(y,{onValueChange:z,value:c,children:[e.jsx(P,{className:"w-full p-4 rounded-xl border-2 border-gray-200 focus:border-amber-300 transition-colors",children:e.jsx(V,{placeholder:"เลือกจังหวัด"})}),e.jsx(I,{className:"max-h-60",children:se.map(s=>e.jsx(n,{value:s,children:s},s))})]}),t.formState.errors.province&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:t.formState.errors.province.message})]}),e.jsxs("div",{className:"relative",children:[e.jsxs(a,{className:"text-base font-medium text-gray-700 mb-3 block flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),"โรงเรียน"]}),e.jsxs("div",{className:"relative",children:[e.jsx(i,{type:"text",value:T,onChange:s=>O(s.target.value),placeholder:"ค้นหาโรงเรียน...",className:"w-full p-4 rounded-xl border-2 border-gray-200 focus:border-amber-300 transition-colors",disabled:!c}),w.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 z-10 bg-white border-2 border-gray-200 rounded-xl mt-1 max-h-48 overflow-y-auto shadow-lg",children:w.map((s,o)=>e.jsxs("button",{type:"button",onClick:()=>U(s),className:"w-full p-3 text-left hover:bg-amber-50 transition-colors border-b border-gray-100 last:border-b-0",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.name}),s.address&&e.jsx("div",{className:"text-sm text-gray-600",children:s.address})]},o))})]}),!c&&e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"กรุณาเลือกจังหวัดก่อน"}),t.formState.errors.school&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:t.formState.errors.school.message})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"currentPassword",className:"block text-sm font-medium text-accent-brown mb-3",children:"รหัสผ่านปัจจุบัน"}),e.jsx(i,{id:"currentPassword",type:"password",placeholder:"ใส่รหัสผ่านปัจจุบัน",className:"form-input rounded-xl border-0 bg-white ring-1 ring-tea-milk-base focus:ring-2 focus:ring-tea-milk-dark",...t.register("currentPassword")}),t.formState.errors.currentPassword&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:t.formState.errors.currentPassword.message})]}),e.jsxs("div",{children:[e.jsxs(a,{htmlFor:"newPassword",className:"block text-sm font-medium text-accent-brown mb-3",children:["รหัสผ่านใหม่ ",e.jsx("span",{className:"text-sm text-gray-500",children:"(ไม่บังคับ)"})]}),e.jsx(i,{id:"newPassword",type:"password",placeholder:"ใส่รหัสผ่านใหม่",className:"form-input rounded-xl border-0 bg-white ring-1 ring-tea-milk-base focus:ring-2 focus:ring-tea-milk-dark",...t.register("newPassword")}),t.formState.errors.newPassword&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:t.formState.errors.newPassword.message})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"confirmNewPassword",className:"block text-sm font-medium text-accent-brown mb-3",children:"ยืนยันรหัสผ่านใหม่"}),e.jsx(i,{id:"confirmNewPassword",type:"password",placeholder:"ใส่รหัสผ่านใหม่อีกครั้ง",className:"form-input rounded-xl border-0 bg-white ring-1 ring-tea-milk-base focus:ring-2 focus:ring-tea-milk-dark",...t.register("confirmNewPassword")}),t.formState.errors.confirmNewPassword&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:t.formState.errors.confirmNewPassword.message})]}),e.jsx("div",{children:e.jsx(S,{type:"submit",disabled:b.isPending,className:"w-full btn-primary py-4 rounded-xl text-lg font-semibold transform hover:scale-105 transition-all duration-300",children:b.isPending?"กำลังบันทึก...":"💾 บันทึกการเปลี่ยนแปลง"})})]})]})})}export{ce as default};
